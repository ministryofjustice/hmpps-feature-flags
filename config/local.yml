version: "2.0"

authentication:
  required: true
  session:
    domain: "127.0.0.1"
    secure: false
    csrf:
      secure: false
  methods:
    token:
      enabled: true
      storage:
        tokens:
          local-admin:
            credential: "${env:FLIPT_LOCAL_ADMIN_TOKEN}"
            metadata:
              github_teams: "{\"ministryofjustice\":[\"hmpps-feature-flag-admins\"]}"
          local-car:
            credential: "${env:FLIPT_LOCAL_CAR_TOKEN}"
            metadata:
              token_namespace: "consider-a-recall"
    github:
      enabled: true
      client_id: "${env:FLIPT_LOCAL_GITHUB_CLIENT_ID}"
      client_secret: "${env:FLIPT_LOCAL_GITHUB_CLIENT_SECRET}"
      redirect_address: "http://127.0.0.1:8080"
      scopes:
        - "user:email"
        - "read:user"
        - "read:org"
      allowed_organizations:
        - "ministryofjustice"

authorization:
  required: true
  local:
    policy:
      path: "/etc/flipt/policies/local-namespace.rego"
      poll_interval: "10s"

storage:
  main:
    backend:
      type: local
      path: "/workspace"

environments:
  dev:
    name: "Development"
    storage: "main"
    default: true
    directory: "flags/dev"
  prod:
    name: "Production"
    storage: "main"
    directory: "flags/prod"
